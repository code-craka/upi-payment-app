<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPI Admin Dashboard - Debug Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-8">UPI Admin Dashboard - Debug Tools</h1>
            
            <!-- Session Claims Debug Section -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">üîç Session Claims Debug</h2>
                <p class="text-gray-600 mb-4">Check your current session claims and role configuration:</p>
                
                <button id="checkSession" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                    Check Session Claims
                </button>
                
                <div id="sessionResult" class="mt-4 p-4 bg-gray-100 rounded-lg hidden">
                    <pre id="sessionData" class="text-sm overflow-auto"></pre>
                </div>
            </div>

            <!-- Role Assignment Section -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">üëë Admin Role Assignment</h2>
                <p class="text-gray-600 mb-4">Assign admin role to codecraka@gmail.com:</p>
                
                <button id="assignRole" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    Make codecraka@gmail.com Admin
                </button>
                
                <div id="roleResult" class="mt-4 p-4 bg-gray-100 rounded-lg hidden">
                    <pre id="roleData" class="text-sm overflow-auto"></pre>
                </div>
            </div>

            <!-- User List Section -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">üë• All Users & Roles</h2>
                <p class="text-gray-600 mb-4">View all users and their current roles:</p>
                
                <button id="listUsers" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    List All Users
                </button>
                
                <div id="userListResult" class="mt-4 p-4 bg-gray-100 rounded-lg hidden">
                    <pre id="userListData" class="text-sm overflow-auto"></pre>
                </div>
            </div>

            <!-- Instructions -->
            <div class="mt-8 p-4 bg-blue-50 border-l-4 border-blue-400">
                <h3 class="text-lg font-semibold text-blue-900 mb-2">Instructions:</h3>
                <ol class="list-decimal list-inside text-blue-800 space-y-1">
                    <li>First, click "Check Session Claims" to see your current role status</li>
                    <li>If your role shows as null or undefined, click "Make codecraka@gmail.com Admin"</li>
                    <li>After setting the role, refresh the page and sign out/in to refresh your session</li>
                    <li>Check session claims again to verify the role is now set</li>
                    <li>Try accessing the admin dashboard at <a href="/admin" class="underline">/admin</a></li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // Check session claims
        document.getElementById('checkSession').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/debug/session-claims');
                const data = await response.json();
                
                document.getElementById('sessionData').textContent = JSON.stringify(data, null, 2);
                document.getElementById('sessionResult').classList.remove('hidden');
            } catch (error) {
                document.getElementById('sessionData').textContent = `Error: ${error.message}`;
                document.getElementById('sessionResult').classList.remove('hidden');
            }
        });

        // Assign admin role
        document.getElementById('assignRole').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/admin-bootstrap', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'codecraka@gmail.com',
                        action: 'make-admin'
                    })
                });
                const data = await response.json();
                
                document.getElementById('roleData').textContent = JSON.stringify(data, null, 2);
                document.getElementById('roleResult').classList.remove('hidden');
                
                if (data.success) {
                    alert('Role assigned successfully! Please sign out and sign back in to refresh your session.');
                }
            } catch (error) {
                document.getElementById('roleData').textContent = `Error: ${error.message}`;
                document.getElementById('roleResult').classList.remove('hidden');
            }
        });

        // List all users
        document.getElementById('listUsers').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/admin-bootstrap');
                const data = await response.json();
                
                document.getElementById('userListData').textContent = JSON.stringify(data, null, 2);
                document.getElementById('userListResult').classList.remove('hidden');
            } catch (error) {
                document.getElementById('userListData').textContent = `Error: ${error.message}`;
                document.getElementById('userListResult').classList.remove('hidden');
            }
        });
    </script>
</body>
</html>